<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DPM Camera Job Tracker</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #151b3d;
            --accent-not-started: #ef4444;
            --accent-in-progress: #fbbf24;
            --accent-completed: #10b981;
            --accent-no-issues: #3b82f6;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border: #1e293b;
            --shadow: rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: 100vh;
            gap: 0;
        }

        .map-section {
            position: relative;
            background: var(--bg-secondary);
            border-right: 2px solid var(--border);
        }

        #map {
            width: 100%;
            height: 100%;
            background: var(--bg-secondary);
        }

        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(10, 14, 39, 0.95);
            padding: 20px 30px;
            border-radius: 12px;
            border: 2px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px var(--shadow);
        }

        .header h1 {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 24px;
            letter-spacing: -0.5px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1000;
            background: rgba(10, 14, 39, 0.95);
            padding: 16px 20px;
            border-radius: 10px;
            border: 2px solid var(--border);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px var(--shadow);
        }

        .legend-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            color: var(--text-secondary);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .sidebar {
            background: var(--bg-primary);
            overflow-y: auto;
            padding: 30px;
            border-left: 1px solid var(--border);
        }

        .sidebar-header {
            margin-bottom: 30px;
        }

        .sidebar-header h2 {
            font-family: 'JetBrains Mono', monospace;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .sidebar-header p {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .stat-number {
            font-family: 'JetBrains Mono', monospace;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .location-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .location-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .location-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.2);
        }

        .location-name {
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .location-address {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .location-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-not-started {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-not-started);
            border: 1px solid var(--accent-not-started);
        }

        .status-in-progress {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-in-progress);
            border: 1px solid var(--accent-in-progress);
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-completed);
            border: 1px solid var(--accent-completed);
        }

        .status-no-issues {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-no-issues);
            border: 1px solid var(--accent-no-issues);
        }

        .leaflet-popup-content-wrapper {
            background: var(--bg-primary);
            color: var(--text-primary);
            border-radius: 12px;
            border: 2px solid var(--border);
            box-shadow: 0 10px 40px var(--shadow);
            font-family: 'Space Mono', monospace;
            padding: 0;
            overflow: hidden;
        }

        .leaflet-popup-content {
            margin: 0;
            width: 350px !important;
        }

        .popup-content {
            padding: 20px;
        }

        .popup-header {
            margin-bottom: 16px;
        }

        .popup-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .popup-address {
            font-size: 11px;
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            background: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 10px 12px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .leaflet-popup-tip {
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-top: none;
            border-right: none;
        }

        /* Custom marker styles */
        .custom-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            transition: all 0.2s ease;
        }

        .custom-marker:hover {
            transform: scale(1.2);
        }

        .marker-not-started {
            background: var(--accent-not-started);
        }

        .marker-in-progress {
            background: var(--accent-in-progress);
            animation: pulse 2s ease-in-out infinite;
        }

        .marker-completed {
            background: var(--accent-completed);
        }

        .marker-no-issues {
            background: var(--accent-no-issues);
        }

        .notes-history {
            margin-top: 12px;
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
        }

        .history-entry {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
        }

        .history-entry:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .history-date {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 700;
        }

        .history-text {
            font-size: 12px;
            color: var(--text-primary);
            line-height: 1.5;
            white-space: pre-wrap;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            }
            50% {
                box-shadow: 0 4px 12px rgba(251, 191, 36, 0.6), 0 0 20px rgba(251, 191, 36, 0.4);
            }
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: 60vh 1fr;
            }

            .map-section {
                border-right: none;
                border-bottom: 2px solid var(--border);
            }

            .sidebar {
                max-height: 40vh;
            }
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 9999;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 16px; color: var(--text-secondary);">Loading tracker...</p>
    </div>

    <div class="container" style="display: none;" id="app">
        <div class="map-section">
            <div class="header">
                <h1>DPM Camera Job Tracker</h1>
                <p>Real-time collaborative tracking system</p>
            </div>
            <div class="legend">
                <div class="legend-title">Status Legend</div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-not-started);"></div>
                    <span>Not Started</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-in-progress);"></div>
                    <span>In Progress</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-completed);"></div>
                    <span>Completed</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: var(--accent-no-issues);"></div>
                    <span>No Issues</span>
                </div>
            </div>
            <div id="map"></div>
        </div>

        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Job Dashboard</h2>
                <p>Click any location on the map or in the list below to view or update job details.</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--accent-not-started);" id="stat-not-started">0</div>
                    <div class="stat-label">Not Started</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--accent-in-progress);" id="stat-in-progress">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--accent-completed);" id="stat-completed">0</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" style="color: var(--accent-no-issues);" id="stat-no-issues">0</div>
                    <div class="stat-label">No Issues</div>
                </div>
            </div>

            <div class="location-list" id="location-list"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module">
        // Firebase configuration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
        import { getDatabase, ref, set, onValue, get } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js';

        // IMPORTANT: Replace this with your own Firebase config
        // Instructions at the bottom of the file
        const firebaseConfig = {
apiKey: "AIzaSyDnvQgObDjV5ptukivRc3uTAI_bOok1zBA",
authDomain: "dpmcamera-tracker.firebaseapp.com",
databaseURL: "https://dpmcamera-tracker-default-rtdb.firebaseio.com",
projectId: "dpmcamera-tracker",
storageBucket: "dpmcamera-tracker.firebasestorage.app",
messagingSenderId: "109937735873l",
appId: "1:109937735873l:web:3776dedb97a4fe893de18e"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Location data from PDF
        const locations = [
            { name: "Burger King #22027 Alvord", address: "8417 N.US Hwy 287, Alvord, TX 76225", lat: 33.3925543, lng: -97.7297886 },
            { name: "Paradise QS #04 - Alvord", address: "8417 N. US Hwy 287, Alvord, TX 76225", lat: 33.3925543, lng: -97.7297886 },
            { name: "Burger King #27083 Azle", address: "1001 Boyd Road, Azle, TX 76020", lat: 32.9103543, lng: -97.5440232 },
            { name: "Paradise QS #14 - White Settlement", address: "9913 White Settlement Rd., Fort Worth, TX 76108", lat: 32.7589535, lng: -97.4917004 },
            { name: "Burger King #28626 Bailey Boswell", address: "4541 W. Bailey Boswell, Fort Worth, TX 76179", lat: 32.8804702, lng: -97.3928522 },
            { name: "Burger King #27084 Saginaw", address: "6960 N Blue Mound Road, Fort Worth, TX 76131", lat: 32.8681978, lng: -97.341787 },
            { name: "Burger King #27082 Alliance/TMS", address: "15933 North Freeway, Fort Worth, TX 76177", lat: 33.0252883, lng: -97.2760128 },
            { name: "Paradise QS #01 - Sun Valley", address: "5401 Sun Valley Dr., Fort Worth, TX 76119", lat: 32.6795074, lng: -97.2398344 },
            { name: "Burger King #26183 Denton", address: "2215 West University Drive, Denton, TX 76201", lat: 33.2292022, lng: -97.159802 },
            { name: "Burger King #27028 Gainesville", address: "1711 North I-35, Gainesville, TX 76240", lat: 33.641515, lng: -97.1579193 },
            { name: "Burger King #3675 Denton", address: "2233 S Loop 288, Denton, TX 76205", lat: 33.1869188, lng: -97.1066459 },
            { name: "Paradise QS #03 - Grapevine", address: "513 E. Northwest Hwy, Grapevine, TX 76051", lat: 32.9413343, lng: -97.0731222 },
            { name: "Burger King #26924 Corinth", address: "8001 S. Interstate 35 E, Corinth, TX 76210", lat: 33.1323896, lng: -97.0414887 },
            { name: "Burger King #28514 Midlothian", address: "2251 FM 663, Midlothian, TX 76065", lat: 32.4600926, lng: -96.9959456 },
            { name: "Burger King #28313 Cross Roads", address: "11881 US-380, Cross Roads, TX 76227", lat: 33.2241299, lng: -96.9820109 },
            { name: "Paradise QS #02 - Lewsville", address: "521 E. Hwy 121, Lewisville, TX 75057", lat: 32.9906715, lng: -96.9780407 },
            { name: "Burger King #9723 The Colony", address: "3700 Main St, The Colony, TX 75056", lat: 33.0674516, lng: -96.8893989 },
            { name: "Scarborough Car Wash", address: "1448 FM 66, Waxahachie, TX 75167", lat: 32.3741146, lng: -96.8662758 },
            { name: "7-Eleven - Riverfront", address: "1005 S. Riverfront Blvd., Dallas, TX 75207", lat: 32.7654016, lng: -96.8034512 },
            { name: "Burger King #13192 Plano (Ohio)", address: "8720 Ohio Dr, Plano, TX 75024", lat: 33.0978387, lng: -96.7961826 },
            { name: "Scarborough Travel Stop", address: "3298 S Interstate Hwy 35 E, Waxahachie, TX 75165", lat: 32.3782774, lng: -96.7708138 },
            { name: "Burger King #4851 Plano (Coit)", address: "2009 Coit Rd, Plano, TX 75075", lat: 33.0284064, lng: -96.7706873 },
            { name: "Burger King #6460 Mckinney", address: "1700 W. University Dr, McKinney, TX 75069", lat: 33.2169105, lng: -96.6320383 },
            { name: "Burger King #28312 Mesquite", address: "2104 N Galloway Ave, Mesquite, TX 75150", lat: 32.7938775, lng: -96.6116061 },
            { name: "Burger King #28174 Melissa", address: "2651 Sam Rayburn Hwy, Melissa, TX 75454", lat: 33.2834364, lng: -96.56246 },
            { name: "Burger King #28683 Sunnyvale", address: "480 US Hwy 80, Sunnyvale, TX 75182", lat: 32.7832645, lng: -96.5601677 },
            { name: "Burger King #27415 Kaufman", address: "700 E. Highway 175, Kaufman, TX 75142", lat: 32.6488448, lng: -96.5413512 },
            { name: "Burger King #24875 Royse City", address: "440 W. Interstate 30, Royse City, TX 75189", lat: 32.9661228, lng: -96.3390095 },
            { name: "Burger King #25198 Terrell", address: "1204 W. Moore Avenue, Terrell, TX 75160", lat: 32.739396, lng: -96.2920632 },
            { name: "Burger King #11460 Bonham", address: "1801 North, TX-121, Bonham, TX 75418", lat: 33.5930631, lng: -96.192829 },
            { name: "Burger King #27958 Quinlan", address: "8909 State Highway 34 South, Quinlan, TX 75474", lat: 32.9054312, lng: -96.1276293 },
            { name: "Burger King #20671 Greenville", address: "7315 I-30 Frontage Rd, Greenville, TX 75402", lat: 33.0953616, lng: -96.1072047 },
            { name: "Burger King #2390 Paris", address: "3590 Lamar, Paris, TX 75460", lat: 33.660776, lng: -95.5103595 },
            { name: "Paradise QS #16 - MT Pleasant", address: "2011 North Jefferson Ave., Mt. Pleasant, TX 75455", lat: 33.1772915, lng: -94.9708888 },
            { name: "Paradise QS #15 - Pittsburg", address: "635 Mt Pleasant Street, Pittsburg, TX 75686", lat: 33.0094559, lng: -94.9644747 },
            { name: "Burger King #24008 New Boston", address: "900 N. McCoy Blvd., New Boston, TX 75570", lat: 33.4760206, lng: -94.4088946 },
            { name: "Paradise QS #11 - New Boston City", address: "900 N. McCoy Blvd., New Boston, TX 75570", lat: 33.4760206, lng: -94.4088946 },
            { name: "Burger King #26015 Hooks", address: "580 Lone Star Dr., Hooks, TX 75561", lat: 33.4671733, lng: -94.2366504 },
            { name: "Paradise QS #13 - Hooks", address: "580 Lone Star Dr., Hooks, TX 75561", lat: 33.4671733, lng: -94.2366504 },
            { name: "Burger King #23086 Atlanta", address: "299 U.S. 59, Atlanta, TX 75551", lat: 33.1178617, lng: -94.181756 },
            { name: "Burger King #10358 Nash", address: "1970 N. Kings Hwy, Nash, TX 75569", lat: 33.4522178, lng: -94.1301793 },
            { name: "Paradise QS #06 - Nash", address: "1970 N. Kings Hwy, Nash, TX 75569", lat: 33.4522178, lng: -94.1301793 },
            { name: "Paradise QS #08 - Ashdown", address: "950 S. Constitution Avenue, Ashdown, AR 71822", lat: 33.6625838, lng: -94.1192361 },
            { name: "Subway 22411", address: "4103 W, 7th St., Texarkana, TX 75503", lat: 33.4187104, lng: -94.0941756 },
            { name: "Paradise QS #07 - 7th St", address: "4103 W, 7th St., Texarkana, TX 75501", lat: 33.4185738, lng: -94.0940653 },
            { name: "Paradise QS #09 - New Boston Rd", address: "3400 New Boston Rd., Texarkana, TX 75501", lat: 33.4403875, lng: -94.0875947 },
            { name: "Paradise QS #12- Summerhill", address: "4621 Summerhill Rd., Texarkana, TX 75503", lat: 33.4630376, lng: -94.0661119 },
            { name: "Paradise QS #10 - Texas Blvd", address: "3300 Texas Blvd, Texarkana, TX 75503", lat: 33.448522, lng: -94.0527795 },
            { name: "Paradise QS #05 - Hope", address: "901 W. 3rd St., Hope, AR 71801", lat: 33.6646746, lng: -93.6003814 }
        ];

        // Initialize map - centered on Texas/Arkansas region
        const map = L.map('map').setView([33.2, -95.5], 7);
        
        // Add satellite imagery base layer
        L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            attribution: '&copy; Google',
            maxZoom: 20,
            minZoom: 6,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        }).addTo(map);
        
        // Add road/labels overlay
        L.tileLayer('https://mt1.google.com/vt/lyrs=h&x={x}&y={y}&z={z}', {
            attribution: '&copy; Google',
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3']
        }).addTo(map);
        
        // Set max bounds to keep map focused on Texas/Arkansas area
        const southWest = L.latLng(32.0, -98.5);
        const northEast = L.latLng(34.5, -93.5);
        const bounds = L.latLngBounds(southWest, northEast);
        map.setMaxBounds(bounds);
        map.fitBounds(bounds);

        const markers = {};
        let jobData = {};

        // Create unique ID for location
        function getLocationId(location) {
            return `${location.lat}_${location.lng}`;
        }

        // Get marker color based on status
        function getMarkerClass(status) {
            switch(status) {
                case 'in-progress': return 'marker-in-progress';
                case 'completed': return 'marker-completed';
                case 'no-issues': return 'marker-no-issues';
                default: return 'marker-not-started';
            }
        }

        // Create popup content
        function createPopupContent(location, data) {
            const locationId = getLocationId(location);
            const currentData = data || { status: 'no-issues', visitDate: '', issue: '', notesHistory: [] };
            const notesHistory = currentData.notesHistory || [];
            
            let historyHtml = '';
            if (notesHistory.length > 0) {
                historyHtml = `
                    <div class="form-group">
                        <button class="btn btn-secondary" style="width: 100%;" onclick="toggleNotesHistory('${locationId}')">
                            üìã View Old Notes (${notesHistory.length})
                        </button>
                        <div id="history-${locationId}" class="notes-history" style="display: none;">
                            ${notesHistory.map((entry, index) => `
                                <div class="history-entry">
                                    <div class="history-date">${new Date(entry.timestamp).toLocaleString()}</div>
                                    <div class="history-text">${entry.notes}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="popup-content">
                    <div class="popup-header">
                        <div class="popup-title">${location.name}</div>
                        <div class="popup-address">${location.address}</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="status-${locationId}">
                            <option value="no-issues" ${currentData.status === 'no-issues' ? 'selected' : ''}>No Issues</option>
                            <option value="not-started" ${currentData.status === 'not-started' ? 'selected' : ''}>Not Started</option>
                            <option value="in-progress" ${currentData.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                            <option value="completed" ${currentData.status === 'completed' ? 'selected' : ''}>Completed</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Visit Date</label>
                        <input type="date" class="form-input" id="visitdate-${locationId}" 
                               value="${currentData.visitDate || ''}" placeholder="Select visit date">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Issue Description</label>
                        <textarea class="form-textarea" id="issue-${locationId}" 
                                  placeholder="Describe the camera issue...">${currentData.issue || ''}</textarea>
                    </div>

                    ${historyHtml}

                    <div class="form-group">
                        <label class="form-label">Add New Note</label>
                        <textarea class="form-textarea" id="notes-${locationId}" 
                                  placeholder="Add notes, tag each other with @name..."></textarea>
                    </div>

                    <div class="button-group">
                        <button class="btn btn-primary" onclick="saveJobData('${locationId}')">Save</button>
                        <button class="btn btn-secondary" onclick="clearJobData('${locationId}')">Clear All</button>
                    </div>
                </div>
            `;
        }

        // Add markers to map
        function addMarkers() {
            locations.forEach(location => {
                const locationId = getLocationId(location);
                const data = jobData[locationId] || { status: 'no-issues' };
                
                const markerIcon = L.divIcon({
                    className: 'custom-marker ' + getMarkerClass(data.status),
                    iconSize: [24, 24]
                });

                const marker = L.marker([location.lat, location.lng], { icon: markerIcon })
                    .addTo(map)
                    .bindPopup(createPopupContent(location, data), { 
                        maxWidth: 350,
                        autoPan: true,
                        autoPanPadding: [50, 50],
                        keepInView: true
                    });

                marker.on('popupopen', function() {
                    // Refresh popup content with latest data
                    const currentData = jobData[locationId] || { status: 'no-issues' };
                    marker.setPopupContent(createPopupContent(location, currentData));
                    // Pan to center the popup
                    map.panTo(marker.getLatLng());
                });

                markers[locationId] = { marker, location };
            });
        }

        // Update marker appearance
        function updateMarker(locationId) {
            const data = jobData[locationId] || { status: 'no-issues' };
            const markerData = markers[locationId];
            
            if (markerData) {
                const markerIcon = L.divIcon({
                    className: 'custom-marker ' + getMarkerClass(data.status),
                    iconSize: [24, 24]
                });
                markerData.marker.setIcon(markerIcon);
            }
        }

        // Save job data to Firebase
        window.saveJobData = function(locationId) {
            const status = document.getElementById(`status-${locationId}`).value;
            const visitDate = document.getElementById(`visitdate-${locationId}`).value;
            const issue = document.getElementById(`issue-${locationId}`).value;
            const newNote = document.getElementById(`notes-${locationId}`).value;

            // Get existing data
            const existingData = jobData[locationId] || { notesHistory: [] };
            let notesHistory = existingData.notesHistory || [];

            // Add new note to history if not empty
            if (newNote.trim()) {
                notesHistory.push({
                    notes: newNote,
                    timestamp: new Date().toISOString()
                });
            }

            const data = {
                status,
                visitDate,
                issue,
                notesHistory: notesHistory,
                lastUpdated: new Date().toISOString()
            };

            set(ref(database, 'jobs/' + locationId), data)
                .then(() => {
                    alert('‚úì Saved successfully!');
                    // Clear the new note field
                    document.getElementById(`notes-${locationId}`).value = '';
                })
                .catch((error) => {
                    alert('Error saving data: ' + error.message);
                });
        };

        // Toggle notes history display
        window.toggleNotesHistory = function(locationId) {
            const historyDiv = document.getElementById(`history-${locationId}`);
            if (historyDiv) {
                historyDiv.style.display = historyDiv.style.display === 'none' ? 'block' : 'none';
            }
        };

        // Clear job data
        window.clearJobData = function(locationId) {
            if (confirm('Are you sure you want to clear all data for this location?')) {
                set(ref(database, 'jobs/' + locationId), null)
                    .then(() => {
                        alert('‚úì Data cleared!');
                    })
                    .catch((error) => {
                        alert('Error clearing data: ' + error.message);
                    });
            }
        };

        // Update stats
        function updateStats() {
            const stats = { 'not-started': 0, 'in-progress': 0, 'completed': 0, 'no-issues': 0 };
            
            Object.values(jobData).forEach(data => {
                if (data.status) {
                    stats[data.status]++;
                }
            });

            // Count locations without data as no-issues (blue - default)
            stats['no-issues'] += locations.length - Object.keys(jobData).length;

            document.getElementById('stat-not-started').textContent = stats['not-started'];
            document.getElementById('stat-in-progress').textContent = stats['in-progress'];
            document.getElementById('stat-completed').textContent = stats['completed'];
            document.getElementById('stat-no-issues').textContent = stats['no-issues'];
        }

        // Render location list
        function renderLocationList() {
            const listContainer = document.getElementById('location-list');
            listContainer.innerHTML = '';

            locations.forEach(location => {
                const locationId = getLocationId(location);
                const data = jobData[locationId] || { status: 'no-issues' };
                
                const card = document.createElement('div');
                card.className = 'location-card';
                card.innerHTML = `
                    <div class="location-name">${location.name}</div>
                    <div class="location-address">${location.address}</div>
                    <span class="location-status status-${data.status}">
                        ${data.status.replace('-', ' ')}
                    </span>
                `;
                
                card.onclick = () => {
                    // Pan to location with offset to account for popup
                    map.setView([location.lat, location.lng], 13, {
                        animate: true,
                        duration: 0.5
                    });
                    // Small delay to let map pan, then open popup
                    setTimeout(() => {
                        markers[locationId].marker.openPopup();
                    }, 100);
                };
                
                listContainer.appendChild(card);
            });
        }

        // Listen for real-time updates from Firebase
        function setupRealtimeListener() {
            const jobsRef = ref(database, 'jobs');
            onValue(jobsRef, (snapshot) => {
                jobData = snapshot.val() || {};
                
                // Update all markers
                Object.keys(markers).forEach(locationId => {
                    updateMarker(locationId);
                });
                
                updateStats();
                renderLocationList();
            });
        }

        // Initialize app
        async function initApp() {
            try {
                // Load initial data
                const snapshot = await get(ref(database, 'jobs'));
                jobData = snapshot.val() || {};
                
                // Add markers and setup UI
                addMarkers();
                updateStats();
                renderLocationList();
                setupRealtimeListener();
                
                // Hide loading, show app
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
            } catch (error) {
                document.getElementById('loading').innerHTML = `
                    <div style="color: #ef4444;">
                        <p style="font-weight: 700; margin-bottom: 8px;">‚ö†Ô∏è Error connecting to Firebase</p>
                        <p style="font-size: 12px; color: var(--text-secondary);">Make sure you've set up your Firebase config (see instructions at the end of this file)</p>
                    </div>
                `;
                console.error('Firebase error:', error);
            }
        }

        // Start the app
        initApp();
    </script>
</body>
</html>

<!--
===============================================================================
SETUP INSTRUCTIONS - READ THIS CAREFULLY
===============================================================================

This file needs Firebase to work. Firebase is 100% free for your use case.
Here's how to set it up (takes about 5 minutes):

STEP 1: CREATE A FIREBASE PROJECT
----------------------------------
1. Go to https://console.firebase.google.com/
2. Click "Add project" or "Create a project"
3. Name it something like "camera-job-tracker"
4. Disable Google Analytics (you don't need it)
5. Click "Create project"

STEP 2: SET UP REALTIME DATABASE
---------------------------------
1. In your Firebase project, click "Realtime Database" in the left sidebar
2. Click "Create Database"
3. Choose a location (us-central1 is fine)
4. Start in TEST MODE (we'll secure it in a moment)
5. Click "Enable"

STEP 3: SET SECURITY RULES
---------------------------
1. In the Realtime Database page, click the "Rules" tab
2. Replace the rules with this:

{
  "rules": {
    "jobs": {
      ".read": true,
      ".write": true
    }
  }
}

3. Click "Publish"

NOTE: These rules allow anyone with the URL to read/write. For better security,
you could add a simple password check or restrict to specific domains later.

STEP 4: GET YOUR CONFIG
------------------------
1. Click the gear icon next to "Project Overview" in the left sidebar
2. Click "Project settings"
3. Scroll down to "Your apps" section
4. Click the "</>" (web) icon to add a web app
5. Name it "camera-tracker" and click "Register app"
6. Copy the firebaseConfig object that appears

STEP 5: UPDATE THIS FILE
-------------------------
1. Find the firebaseConfig section in this HTML file (around line 562)
2. Replace the placeholder values with your actual Firebase config:

const firebaseConfig = {
    apiKey: "AIza...",  // Your actual API key
    authDomain: "your-project.firebaseapp.com",
    databaseURL: "https://your-project-default-rtdb.firebaseio.com",
    projectId: "your-project-id",
    storageBucket: "your-project.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abc123"
};

STEP 6: HOST ON GITHUB PAGES
-----------------------------
1. Create a new GitHub repository
2. Upload this HTML file (you can name it index.html)
3. Go to repository Settings ‚Üí Pages
4. Under "Source", select "main" branch
5. Click Save
6. Your site will be live at: https://YOUR-USERNAME.github.io/REPO-NAME/

That's it! Both you and your technician can now access the same URL and see
real-time updates as you both make changes.

TIPS:
- Bookmark the GitHub Pages URL on both your devices
- You can edit the file anytime by updating the HTML in your repo
- All data saves automatically - no "save" button needed on the map
- Changes appear instantly for both users

TROUBLESHOOTING:
- If you see "Error connecting to Firebase", check your config values
- If markers don't save, check your Firebase Database rules
- If the map doesn't load, check your internet connection

Need help? The error messages will guide you to what's wrong!
-->`
